# Pandas, SQL и Визуализация данных

Резюме: Сегодня мы поможем вам с визуализацией данных в Matplotlib, Seaborn и Plotly.

## Содержание

1. [Глава I](#chapter-i) \
    1.1. [Вступление](#foreword)
2. [Глава II](#chapter-ii) \
    2.1. [Инструкции](#instructions)
3. [Глава III](#chapter-iii) \
    3.1. [Специальные инструкции на день](#specific-instructions-for-the-day)
4. [Обязательная часть главы IV](#chapter-iv-mandatory-part) \
    4.1. [Упражнение 00 : Линейный график](#exercise-00-line-chart)
5. [Глава V](#chapter-v) \
    5.1. [Упражнение 01 : Линейный график со стилями](#exercise-01-line-chart-with-styles)
6. [Глава VI](#chapter-vi) \
    6.1. [Упражнение 02 : Столбчатая диаграмма](#exercise-02-bar)
7. [Глава VII](#chapter-vii) \
    7.1. [Упражнение 03 : Столбчатые диаграммы](#exercise-03-bar-charts)
8. [Глава VIII](#chapter-viii) \
    8.1. [Упражнение 04 : Гистограмма](#exercise-04-histogram)
9. [Глава IX](#chapter-ix) \
    9.1. [Упражнение 05 : Коробчатая диаграмма (Boxplot)](#exercise-05-boxplot)
10. [Глава X](#chapter-x) \
    10.1. [Часть 1](#exercise-06-scatter-matrix)
11. [Бонусная часть главы XI](#chapter-xi-bonus-part) \
    11.1. [Упражнение 07 : Тепловая карта](#exercise-07-heatmap)
12. [Глава XII](#chapter-xii) \
    12.1. [Упражнение 08 : Seaborn](#exercise-08-seaborn)
13. [Глава XIII](#chapter-xiii) \
    13.1. [Упражнение 09 : Plotly](#exercise-09-plotly)

---

## Глава I

### Вступление

Визуализация полезна по двум причинам. Первая — она очень удобна, когда нужно донести результат до кого-либо: работодателя, коллег, клиентов и т.д. Вторая — помогает лучше понять данные. Вот пример, показывающий, почему это важно.

Представьте или используйте лист бумаги для построения графика распределения двух переменных со следующими характеристиками.

![1](misc/images/1.png)

Думаете, существует только один способ расположить точки?

Нет, их несколько. Это называется [квадрат Анскомба](https://en.wikipedia.org/wiki/Anscombe's_quartet).

![2](misc/images/2.png)

Все графики выше имеют одинаковые характеристики. Вы верите?

Оценка характеристик только по ним может вводить в заблуждение. Используйте графики для лучшего понимания данных.

---

## Глава II

### Инструкции

* Используйте эту страницу как единственный источник информации. Не слушайте слухи и спекуляции о том, как готовить решение.
* Отныне и далее используйте Python 3 как единственную правильную версию Python.
* Решения для упражнений на Python (d01, d02, d03) должны содержать в конце блок: ```if __name__ == '__main__'```.
* Обратите внимание на права доступа к файлам и папкам.
* Для оценки ваше решение должно находиться в вашем GIT-репозитории.
* Ваши решения будут оценены сверстниками.
* Не оставляйте в папке лишние файлы, кроме тех, что явно указаны в задании. Рекомендуется настроить .gitignore, чтобы избежать ошибок.
* Решение должно быть в вашем GIT-репозитории для оценки. Вышлите только ветку develop! Мастер игнорируется. Работайте в папке src.
* При необходимости получения точных результатов не отображайте предварительно рассчитанный вывод — делайте вычисления правильно.
* Возник вопрос? Спросите соседа справа. Если не поможет — слева.
* Ваши источники: сверстники / интернет / Google.
* Можно задавать вопросы в Slack.
* Внимательно читайте примеры. Они могут требовать дополнительных условий, не прописанных явно.
* Да пребудет с вами Сила!

---

## Глава III

### Специальные инструкции на день

* Используйте Jupyter Notebook для работы с кодом.
* Импорты не допускаются, кроме тех, что явно указаны в разделе "Допустимые функции" каждого упражнения.
* Можете использовать любые встроенные функции, если они не запрещены.
* Сохраняйте и загружайте все необходимые данные в подпапке data/.

---

## Обязательная часть главы IV

### Упражнение 00 : Линейный график

Упражнение 00

Линейный график

Папка для сдачи: ex00/

Файлы для сдачи: 00_line_chart.ipynb

Допустимые функции: import pandas as pd, import sqlite3

Сегодня вы будете работать с теми же наборами данных, что и вчера.

Мы попытаемся понять данные о поведении студентов образовательной компании. Вы снова используете Pandas и SQL для оттачивания навыков и использования разных библиотек для визуализации в Python: Matplotlib, Seaborn и Plotly.

Начнем с простого. Если вы еще не рисовали график в Python, самое время сделать первый раз.

Помните, как мы анализировали страницу новостей? Вам было интересно, как часто посещалась страница с течением времени?

* установите соединение с базой данных (та же, что и вчера)
* выполните запрос, который извлекает datetime из таблицы pageviews, выбирая только пользователей, а не админов
* с помощью Pandas создайте новый DataFrame, в котором визиты считаются и группируются по дате
* с помощью метода Pandas .plot() создайте график:
    * размер шрифта — 8
    * размер фигуры — (15,8)
    * график должен иметь название "Просмотры за день"
    * обратите внимание на вращение подписей оси X (xticks)
* закройте соединение с базой данных

![3](misc/images/3.png)

## Глава V

### Упражнение 01 : Линейный график с стилями

Упражнение 01

Линейный график со стилями

Директория для сдачи : ex01/

Файлы для сдачи : 01_line_chart_styles.ipynb

Допустимые функции : import pandas as pd, import sqlite3

Здорово! Помните, что у нас есть данные о коммитах? Не было бы здорово
отобразить оба метрика во времени на одном графике? А если мы увидим какие-то закономерности?

Вам нужно создать именно такой же график, как ниже (как по значениям, так и по стилю):

![4](misc/images/4.png)

* анализировать только пользователей, а не администраторов
* анализировать только даты, когда были и просмотры, и проверочные коммиты
* использовать размер шрифта 8
* размер фигуры (15,8)
* в конце вашего Jupyter Notebook создайте markdown-клетку и вставьте вопрос:
  “Сколько раз число просмотров было больше 150?” Вставьте: “Ответ
  ___”. Вставьте число вместо линий.

## Глава VI

### Упражнение 02 : Гистограмма

Упражнение 02

Гистограмма

Директория для сдачи : ex02/

Файлы для сдачи : 02_bar_chart.ipynb

Допустимые функции : import pandas as pd, import sqlite3

У нас есть ещё один вопрос для вас: когда наши пользователи обычно делают коммиты: ночью, утром, днём или вечером? И как это менялось со временем?

Сделайте всё, что нужно, чтобы создать график, похожий на этот:

![5](misc/images/5.png)

* анализировать только пользователей, а не администраторов
* размер шрифта и размер фигуры остаются такими же
* ночь — с 00:00:00 до 03:59:59, утро — с 04:00:00 до 09:59:59, день — с 10:00:00 до 16:59:59, вечер — с 17:00:00 до 23:59:59
* выберите палитру, которая вам очень нравится, не обязательно повторять её из графика
* в конце вашего Jupyter Notebook создайте markdown-клетку и вставьте вопросы:
  * “Когда наши пользователи обычно делают коммиты: ночью, утром, днём или вечером?”, ответ — два самых популярных времени.
  * Какой день:
    * имеет больше всего коммитов
    * и при этом число коммитов вечером выше, чем днем?

Ответ — дата этого дня.

## Глава VII

### Упражнение 03 : Гистограммы

Упражнение 03

Гистограммы

Директория для сдачи : ex03/

Файлы для сдачи : 03_bar_charts.ipynb

Допустимые функции : import pandas as pd, import sqlite3

Что если среднее число коммитов отличается в рабочие дни и в выходные?

Сделайте всё, что нужно, чтобы создать график, похожий на этот:

![6](misc/images/6.png)

* анализировать только пользователей, а не администраторов
* размеры шрифта и фигуры остаются такими же
* для каждого часа вычислите среднее число коммитов в рабочие дни и в выходные
(если в этот час не было коммитов, не используйте его для расчёта среднего). Используйте эти значения для вашего графика, например: пн, 17-18: 5 коммитов, вт, 17-18: 6 коммитов, ср, 17-18: 7 коммитов
* выберите палитру, которая вам очень нравится, не обязательно повторять её из графика
* в конце вашего Jupyter Notebook создайте markdown-клетку и вставьте вопрос:
  * “Различается ли динамика коммитов в рабочие дни и выходные?”, в ответе укажите час, когда число коммитов было самое большим в рабочие дни, и час, когда оно было самое большим в выходные.
  
## Глава VIII

### Упражнение 04 : Гистограмма

Упражнение 04

Гистограмма

Директория для сдачи : ex04/

Файлы для сдачи : 04_histogram.ipynb

Допустимые функции : import pandas as pd, import sqlite3, import matplotlib.pyplot as plt

В предыдущем упражнении вам нужно было построить распределение, группируя значения с помощью Pandas. Не было бы здорово, если бы мы могли сделать это более автоматизировано? Тогда да.

Но для этого нужно использовать другой тип визуализации — гистограммы. На этот раз мы не будем использовать средние значения. Мы будем использовать абсолютное число коммитов и сравнивать их в рабочие дни и выходные.

Сделайте всё необходимое, чтобы создать график, похожий на этот:

![7](misc/images/7.png)

* анализировать только пользователей, а не администраторов
* создайте два списка значений (для рабочих дней и для выходных) для входных данных гистограммы
* размеры фигуры остаются такими же, выберите размер шрифта и цветовую палитру
* используйте уровень прозрачности для переднего слоя гистограммы равный 0.7
* в конце вашего Jupyter Notebook создайте markdown-клетку и вставьте вопрос:
“Есть ли часы, когда общее число коммитов было больше в выходные, чем в рабочие дни?” В вашем ответе укажите 4 лучших примера.

## Глава IX

### Упражнение 05 : Ящичный график (Boxplot)

Упражнение 05

Ящичный график

Каталог для сдачи : ex05/

Файлы для сдачи : 05_boxplot.ipynb

Разрешённые функции : import pandas as pd, import sqlite3, import matplotlib.pyplot as plt

Помните, как мы пытались выяснить, влияет ли новостная лента на поведение тестовой и контрольной групп? В прошлый раз мы просто вычисляли средние значения. Но знаем ли мы что‑то о дисперсиях? А что если они тоже изменились? Или если были выбросы?

Для ответа на эти вопросы может быть полезно построить ящичный график.

Сделайте всё необходимое, чтобы создать график, похожий на этот:

![8](misc/images/8.png)

* используйте данные из `файла`, прочитайте их в DataFrame и при необходимости внесите любые изменения, которые помогут решить задачу
* размер фигуры (figsize) оставить прежним, размер шрифта можно выбрать любой
* цветовая палитра должна соответствовать примеру
* размер шрифта заголовка — 15
* толщина линий ящика — 3, толщина линии медианы — 2
* в конце Jupyter Notebook создайте markdown‑ячейку и вставьте вопрос:
  «Каков был межквартильный размах (IQR) контрольной группы до новостной ленты?»
  В ответе укажите приблизительное значение, которое можно получить, просто взглянув на график, округлённое до ближайших 10

## Глава X

### Упражнение 06 : Матрица разброса (Scatter Matrix)

Упражнение 06

Матрица разброса

Каталог для сдачи : ex06/

Файлы для сдачи : 06_scatter_matrix.ipynb

Разрешённые функции : import pandas as pd, import sqlite3, from pandas.plotting import scatter_matrix

Помните, как мы пытались выяснить, есть ли корреляция между количеством посещений новостной ленты и средней разницей между первым коммитом и дедлайном лабораторной работы? Проблема в том, что коэффициент корреляции показывает наличие линейной зависимости между двумя переменными. А что если зависимость нелинейная? Как это увидеть? Правильно — построив графики!

Сделайте всё необходимое, чтобы создать график, похожий на этот:

![9](misc/images/9.png)

* создайте DataFrame, в котором для каждого пользователя из тестовой группы указана средняя разница, количество просмотров страниц и количество коммитов
* при вычислении средней разницы и количества коммитов не учитывайте project1
* количество коммитов берите из таблицы checker
* размер фигуры оставить прежним, размер шрифта и цветовую палитру можно выбрать любые
* размер точек — 200
* толщина линий диагональных графиков (kde) — 3
* в конце Jupyter Notebook создайте markdown‑ячейку и вставьте вопросы (ответьте на них, глядя только на графики):
  * «Можно ли сказать, что если у пользователя мало просмотров страниц, то, скорее всего, у него мало коммитов?» Ответ: да или нет.
  * «Можно ли сказать, что если у пользователя мало просмотров страниц, то у него, скорее всего, маленькая средняя разница между первым коммитом и дедлайном?» Ответ: да или нет.
  * «Можно ли сказать, что много пользователей с небольшим количеством коммитов и мало с большим количеством коммитов?» Ответ: да или нет.
  * «Можно ли сказать, что много пользователей с маленькой средней разницей и мало с большой средней разницей?» Ответ: да или нет.

## Глава XI Бонусная часть

### Упражнение 07 : Тепловая карта (Heatmap)

Упражнение 07

Тепловая карта

Каталог для сдачи : ex07/

Файлы для сдачи : 07_heatmap.ipynb

Разрешённые функции : import pandas as pd, import sqlite3, import matplotlib.pyplot as plt, from mpl_toolkits.axes_grid1 import make_axes_locatable

Несколько упражнений назад мы хотели понять, существуют ли разные паттерны поведения пользователей в рабочие дни и выходные. В этом упражнении выясним, есть ли разные паттерны поведения пользователей между разными днями недели и разными часами.

* анализировать только пользователей, не администраторов
* вы можете выбрать любую цветовую палитру для обеих графиков, которые придётся построить
* используйте таблицу checker для запросов
* используйте абсолютные значения коммитов, а не средние
* сортируйте DataFrame по общему количеству коммитов пользователя
* в конце Jupyter Notebook создайте markdown‑ячейку и вставьте вопросы (ответьте, глядя только на графики):
  * «Какой пользователь сделал больше всего коммитов во вторник?» Ответ: user_*.
  * «Какой пользователь сделал больше всего коммитов в четверг?» Ответ: user_*.
  * «В какой день недели пользователям не нравится делать много коммитов?» Ответ, например: Пн.
  * «Какой пользователь в какой час сделал наибольшее число коммитов?» Ответ, например: user_1, 15

Сделайте всё необходимое, чтобы создать два графика, похожих на эти:

![10](misc/images/10.png)

## Глава XII

### Упражнение 08 : Seaborn

Упражнение 08

Seaborn

Каталог для сдачи : ex08/

Файлы для сдачи : 08_seaborn.ipynb

Разрешённые функции : import pandas as pd, import sqlite3, import matplotlib.pyplot as plt, import seaborn as sns

Иногда в предыдущих задачах мы игнорировали project1 в расчетах. Это был конкурс с более длинными дедлайнами и большим количеством коммитов, чем у обычных лабораторных. Давайте посмотрим динамику коммитов в этом проекте по пользователям. На этот раз мы воспользуемся другой библиотекой для визуализации данных в Python — Seaborn. В целом, с её помощью проще создавать красивые графики.

Сделайте всё необходимое, чтобы создать график, похожий на этот:

![11](misc/images/11.png)

* анализировать только пользователей, не администраторов
* учитывать только логи из таблицы checker со статусом ready
* выбрать любую цветовую палитру на ваш вкус
* толщина линий — 3
* фон графика — серый
* высота — 10, ширина — в 1.5 раза больше высоты
* размер шрифта заголовка — 30
* размер шрифтов названий осей — 15
* в конце Jupyter Notebook создать markdown‑ячейку и вставить вопросы (ответы дать, глядя только на графики):
  * «Кто был лидером по количеству коммитов почти всё время?» Ответ: user_*.
  * «Кто был лидером лишь короткое время?» Ответ: user_*.

## Глава XIII

### Упражнение 09 : Plotly

Упражнение 09

Plotly

Каталог для сдачи : ex09/

Файлы для сдачи : 09_plotly.ipynb

Разрешённые функции : import pandas as pd, import sqlite3, import plotly.graph_objects as go, import numpy as np

* Matplotlib и Seaborn — действительно мощные библиотеки, и с их помощью можно решать большинство задач по визуализации данных. Но они не предлагают возможность создавать интерактивные графики и анимации. В этом вам поможет Plotly. В этом упражнении вам нужно будет создать почти такой же график, как и в предыдущем, но в виде анимации.

Сделайте всё необходимое, чтобы создать график, похожий на этот:

![12](misc/images/12.png)

Это непростая задача, и найти хорошие и простые руководства сложно, поэтому используйте эту [ссылку](https://github.com/datageekrj/YouTubeChannelHostingFiles/blob/master/lineRace.py) в качестве справочного материала.